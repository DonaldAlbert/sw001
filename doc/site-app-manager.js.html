<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: site-app-manager.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: site-app-manager.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

/**
* Code responsible for handling the site configurations of the CMS.
*
* @module site-app-manager
*/


var koa = require('koa')
    , vhost = require('koa-vhost')
    , router = require('koa-router')
    , compose = require('koa-compose');


module.exports.SiteAppManager = SiteAppManager;



/**
 * Class managing the generators, applications and vhosts for a site.
 *
 * @class SiteAppManager
 * @param {string} path - The site's directory
 */
function SiteAppManager(site) {
    this._allwaysCallNext = function(generator) {
        return function *(next) {
            yield *generator.call(this, function*(){});
            yield *next;
        };
    };

    this._getCallbackNoHost = function() {
        var generators = [this._router.routes()];
        generators = this._preGenerators
            .join(generators)
            .join(this._postGenerators);
        
        return compose(generators);
    }

    this._getCallbackHosts = function() {
        var hosts = this._site.settings.hosts
            , app = koa()
            , vhostConfig = [];
        
        vhostConfig = hosts.map((host) => {
            return {host: host, app: app};
        });
        this._preGenerators.forEach((gen) => {app.use(gen);} );
        this.app.use(this._router.routes());
        this._postGenerators.forEach((gen) => {app.use(gen);} );

        return this._allwaysCallNext(vhost(vhostConfig));
    }

    this.getCallback = function() {
        if( this._site.settings.hosts === '*' )
            return this._getCallbackNoHost();
        else
            return this._getCallbackHosts();
    }

    

    this._site = site;

    this._router = router();

    this.preGenerators = [];

    this.postGenerators = [];
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-bootstrap.html">bootstrap</a></li><li><a href="module-generator-manager.html">generator-manager</a></li><li><a href="module-site.html">site</a></li><li><a href="module-site-app-manager.html">site-app-manager</a></li><li><a href="module-system.html">system</a></li></ul><h3>Classes</h3><ul><li><a href="module-generator-manager-GeneratorManager.html">GeneratorManager</a></li><li><a href="module-generator-manager-OrderedManp.html">OrderedManp</a></li><li><a href="module-site-app-manager-SiteAppManager.html">SiteAppManager</a></li><li><a href="module-site-Site.html">Site</a></li><li><a href="Server.html">Server</a></li><li><a href="ServerBase.html">ServerBase</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Sat Sep 19 2015 17:16:50 GMT+0300 (EEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
